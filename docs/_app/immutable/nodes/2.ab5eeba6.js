import{s as Je,n as ae,o as Le,r as ze,f as Be}from"../chunks/scheduler.f09cb845.js";import{S as Pe,i as Ye,g as u,h as f,j as p,f as h,k as i,a as U,s as O,m as re,y as Z,c as R,n as oe,l as Ee,z as H,x as o,A as Ce,o as _e,B as Ve}from"../chunks/index.07002c1b.js";import{e as se,c as qe}from"../chunks/logo.cae78e17.js";const Fe=!0,et=Object.freeze(Object.defineProperty({__proto__:null,prerender:Fe},Symbol.toStringTag,{value:"Module"}));function ne(a,e){return Math.floor(Math.random()*(e-a))+a}function je(a,e=!1){const t={day:86400,hour:3600,minute:60};e&&(t.second=1);const l={};let s=a;for(const[v,g]of Object.entries(t)){const m=Math.floor(s/g);s-=m*g,l[v]=m}const d=[];for(const[v,g]of Object.entries(l))if(g!==0){const m=g>1?"s":"";d.push(`${g} ${v}${m}`)}let c=d.join(", ");const _=c.split(",").length-1;if(_!==0)if(_===1)c=c.replace(", "," and ");else{let v=c.split("").reverse().join("");v=v.replace(" ,"," dna ,"),c=v.split("").reverse().join("")}return c}function Me(a,e,t){const l=a.slice();return l[13]=e[t],l[15]=t,l}function Ae(a,e,t){const l=a.slice();return l[13]=e[t],l[15]=t,l}function He(a){let e,t,l,s,d="Roll the dice",c,_,v=`If you score lower than the bot, time will be added. If you do better, time will be removed.
                        <br/>
                        Though, upon first glance these dice seem somewhat... unnatural. Still feeling lucky?`,g,m,T,N,E,P,G,w,k="You",j,C,J,M,Q,ie,z,pe="The bot",ce,L,V,x,me='<span aria-hidden="true">Ã—</span> <span class="sr-only">Close alert</span>',de,X,K,ue,Y,A,fe,W,he,ve,ge,q=se({length:a[5][0]}),b=[];for(let n=0;n<q.length;n+=1)b[n]=Oe(Ae(a,q,n));let F=se({length:a[5][1]}),I=[];for(let n=0;n<F.length;n+=1)I[n]=Re(Me(a,F,n));let y=a[3]!==""&&Ne(a);return{c(){e=u("div"),t=u("div"),l=u("div"),s=u("h4"),s.textContent=d,c=O(),_=u("p"),_.innerHTML=v,g=O(),m=u("div"),T=u("div"),N=u("div"),E=u("div");for(let n=0;n<b.length;n+=1)b[n].c();G=O(),w=u("div"),w.textContent=k,j=O(),C=u("div"),J=u("div"),M=u("div");for(let n=0;n<I.length;n+=1)I[n].c();ie=O(),z=u("div"),z.textContent=pe,ce=O(),L=u("div"),V=u("div"),x=u("button"),x.innerHTML=me,de=O(),X=u("span"),K=re(a[2]),ue=O(),Y=u("div"),A=u("button"),fe=re("Roll the dice"),he=O(),y&&y.c(),this.h()},l(n){e=f(n,"DIV",{class:!0});var D=p(e);t=f(D,"DIV",{class:!0});var r=p(t);l=f(r,"DIV",{class:!0});var S=p(l);s=f(S,"H4",{"data-svelte-h":!0}),Z(s)!=="svelte-oq3r2j"&&(s.textContent=d),c=R(S),_=f(S,"P",{class:!0,"data-svelte-h":!0}),Z(_)!=="svelte-xkac9u"&&(_.innerHTML=v),g=R(S),m=f(S,"DIV",{class:!0});var $=p(m);T=f($,"DIV",{class:!0});var ee=p(T);N=f(ee,"DIV",{class:!0});var be=p(N);E=f(be,"DIV",{class:!0,"data-side":!0,style:!0});var Ie=p(E);for(let B=0;B<b.length;B+=1)b[B].l(Ie);Ie.forEach(h),be.forEach(h),G=R(ee),w=f(ee,"DIV",{class:!0,"data-svelte-h":!0}),Z(w)!=="svelte-12bdzwm"&&(w.textContent=k),ee.forEach(h),j=R($),C=f($,"DIV",{class:!0});var te=p(C);J=f(te,"DIV",{class:!0});var De=p(J);M=f(De,"DIV",{class:!0,"data-side":!0,style:!0});var we=p(M);for(let B=0;B<I.length;B+=1)I[B].l(we);we.forEach(h),De.forEach(h),ie=R(te),z=f(te,"DIV",{class:!0,"data-svelte-h":!0}),Z(z)!=="svelte-1wc6ghh"&&(z.textContent=pe),te.forEach(h),$.forEach(h),ce=R(S),L=f(S,"DIV",{class:!0});var ke=p(L);V=f(ke,"DIV",{role:!0,class:!0});var le=p(V);x=f(le,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Z(x)!=="svelte-oelkob"&&(x.innerHTML=me),de=R(le),X=f(le,"SPAN",{});var ye=p(X);K=oe(ye,a[2]),ye.forEach(h),le.forEach(h),ke.forEach(h),ue=R(S),Y=f(S,"DIV",{class:!0});var Se=p(Y);A=f(Se,"BUTTON",{type:!0,class:!0});var Te=p(A);fe=oe(Te,"Roll the dice"),Te.forEach(h),Se.forEach(h),he=R(S),y&&y.l(S),S.forEach(h),r.forEach(h),D.forEach(h),this.h()},h(){i(_,"class","caption"),i(E,"class","dice"),i(E,"data-side",P=a[5][0]),Ee(E,"background-color","#f7dcda"),i(N,"class","DiceFace"),i(w,"class","mt-2"),i(T,"class","dice-col"),i(M,"class","dice"),i(M,"data-side",Q=a[5][1]),Ee(M,"background-color","#f7dcda"),i(J,"class","DiceFace"),i(z,"class","mt-2"),i(C,"class","dice-col"),i(m,"class","dices w-full"),i(x,"type","button"),i(x,"class","close"),i(V,"role","alert"),i(V,"class","alert alert-dismissible"),H(V,"alert-success",a[1]<=0),H(V,"alert-danger",a[1]>0),i(L,"class","mt-4 w-full"),H(L,"hidden",a[2]===""),i(A,"type","button"),i(A,"class","mb-2 btn btn-primary"),A.disabled=W=a[4]||a[3]!=="",i(Y,"class","text-center"),i(l,"class","DiceExtension card-content flex flex-col items-center"),i(t,"class","dice-container"),i(e,"class","dice-container-row")},m(n,D){U(n,e,D),o(e,t),o(t,l),o(l,s),o(l,c),o(l,_),o(l,g),o(l,m),o(m,T),o(T,N),o(N,E);for(let r=0;r<b.length;r+=1)b[r]&&b[r].m(E,null);o(T,G),o(T,w),o(m,j),o(m,C),o(C,J),o(J,M);for(let r=0;r<I.length;r+=1)I[r]&&I[r].m(M,null);o(C,ie),o(C,z),o(l,ce),o(l,L),o(L,V),o(V,x),o(V,de),o(V,X),o(X,K),o(l,ue),o(l,Y),o(Y,A),o(A,fe),o(l,he),y&&y.m(l,null),ve||(ge=[Ce(x,"click",a[7]),Ce(A,"click",a[6])],ve=!0)},p(n,D){if(D&32){q=se({length:n[5][0]});let r;for(r=0;r<q.length;r+=1){const S=Ae(n,q,r);b[r]?b[r].p(S,D):(b[r]=Oe(),b[r].c(),b[r].m(E,null))}for(;r<b.length;r+=1)b[r].d(1);b.length=q.length}if(D&32&&P!==(P=n[5][0])&&i(E,"data-side",P),D&32){F=se({length:n[5][1]});let r;for(r=0;r<F.length;r+=1){const S=Me(n,F,r);I[r]?I[r].p(S,D):(I[r]=Re(),I[r].c(),I[r].m(M,null))}for(;r<I.length;r+=1)I[r].d(1);I.length=F.length}D&32&&Q!==(Q=n[5][1])&&i(M,"data-side",Q),D&4&&_e(K,n[2]),D&2&&H(V,"alert-success",n[1]<=0),D&2&&H(V,"alert-danger",n[1]>0),D&4&&H(L,"hidden",n[2]===""),D&24&&W!==(W=n[4]||n[3]!=="")&&(A.disabled=W),n[3]!==""?y?y.p(n,D):(y=Ne(n),y.c(),y.m(l,null)):y&&(y.d(1),y=null)},d(n){n&&h(e),Ve(b,n),Ve(I,n),y&&y.d(),ve=!1,ze(ge)}}}function Ue(a){let e,t,l,s,d,c;return{c(){e=u("div"),t=u("img"),s=O(),d=u("div"),c=re(a[0]),this.h()},l(_){e=f(_,"DIV",{class:!0});var v=p(e);t=f(v,"IMG",{src:!0,alt:!0}),s=R(v),d=f(v,"DIV",{class:!0});var g=p(d);c=oe(g,a[0]),g.forEach(h),v.forEach(h),this.h()},h(){Be(t.src,l=qe)||i(t,"src",l),i(t,"alt","Chaster logo"),i(d,"class","mt-4 caption text-lg"),i(e,"class","w-full h-screen flex flex-col items-center justify-center")},m(_,v){U(_,e,v),o(e,t),o(e,s),o(e,d),o(d,c)},p(_,v){v&1&&_e(c,_[0])},d(_){_&&h(e)}}}function Oe(a){let e;return{c(){e=u("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0}),p(e).forEach(h),this.h()},h(){i(e,"class","dot")},m(t,l){U(t,e,l)},p:ae,d(t){t&&h(e)}}}function Re(a){let e;return{c(){e=u("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0}),p(e).forEach(h),this.h()},h(){i(e,"class","dot")},m(t,l){U(t,e,l)},p:ae,d(t){t&&h(e)}}}function Ne(a){let e,t;return{c(){e=u("div"),t=re(a[3])},l(l){e=f(l,"DIV",{});var s=p(e);t=oe(s,a[3]),s.forEach(h)},m(l,s){U(l,e,s),o(e,t)},p(l,s){s&8&&_e(t,l[3])},d(l){l&&h(e)}}}function Ge(a){let e;function t(d,c){return d[0]!==""?Ue:He}let l=t(a),s=l(a);return{c(){e=u("div"),s.c(),this.h()},l(d){e=f(d,"DIV",{class:!0});var c=p(e);s.l(c),c.forEach(h),this.h()},h(){i(e,"class","container-bg w-full h-screen pl-4 pr-4 svelte-rp1h59")},m(d,c){U(d,e,c),s.m(e,null)},p(d,[c]){l===(l=t(d))&&s?s.p(d,c):(s.d(1),s=l(d),s&&(s.c(),s.m(e,null)))},i:ae,o:ae,d(d){d&&h(e),s.d()}}}const xe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwbmpsYmpwY2ZlYnFwYXFrcGh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODg1NDM0NTgsImV4cCI6MjAwNDExOTQ1OH0.CsGySz2c8bIWphE6--T51CsmSeBQajfwvBYfTkjviM4",Xe="https://bpnjlbjpcfebqpaqkphy.supabase.co/functions/v1/token-session-get",Ze="https://bpnjlbjpcfebqpaqkphy.supabase.co/functions/v1/weighted-runtime-roll";function Qe(a,e,t){let l="",s,d="Loading extension data...",c=0,_="",v="",g=!1,m=[ne(1,6),ne(1,6)];Le(async function(){const w=localStorage.getItem("weighted-dice_roll");w!==null&&t(5,m=w.split("").map(C=>parseInt(C)));const k=window.location.hash.substring(1);k!==""&&(l=JSON.parse(decodeURIComponent(k)).mainToken);const j=await fetch(Xe,{method:"POST",headers:{Authorization:`Bearer ${xe}`},body:JSON.stringify({mainToken:l})});if(j.status!==200){console.error(`Error retrieving session data: ${await j.text()}`);return}s=await j.json(),s.regular.nextActionDate!==void 0&&s.role==="wearer"&&await E(),t(0,d="")});let T=-1;function N(w){const k=Math.floor(new Date().getTime()/1e3);if(k<=0)clearInterval(T),t(3,v=""),T=-1;else{const j=je(w-k,!0);t(3,v=`Next action in ${j}`)}}function E(){if(s.role!=="keyholder"&&s.regular.nextActionDate!==null&&T===-1){const w=Math.floor(new Date().getTime()/1e3),k=Math.floor(new Date(s.regular.nextActionDate).getTime()/1e3);w-k<0&&(N(k),T=setInterval(N,1e3,k))}}async function P(){t(4,g=!0);const w=setInterval(()=>{t(5,m=[ne(1,6),ne(1,6)])},100),k=await fetch(Ze,{method:"POST",headers:{Authorization:`Bearer ${xe}`},body:JSON.stringify({mainToken:l})});if(k.status!==200){console.error(`Error rolling dice: ${await k.text()}`);return}const[j,C,J]=await k.json();localStorage.setItem("weighted-dice_roll",j.join("")),clearInterval(w),t(5,m=j),t(1,c=C),t(2,_=c===0?"Draw!":(c>0?"Added ":"Removed ")+je(Math.abs(c))+"!"),s.role==="wearer"&&(s.regular.nextActionDate=J,E()),t(4,g=!1)}function G(){t(2,_="")}return[d,c,_,v,g,m,P,G]}class tt extends Pe{constructor(e){super(),Ye(this,e,Qe,Ge,Je,{})}}export{tt as component,et as universal};
